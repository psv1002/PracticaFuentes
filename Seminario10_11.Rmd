---
title: "Seminario Fuentes"
author:
  - "Aitana Crespo Ferrero" 
  - "Paula Santamaría Velasco" 
  - "Beatriz Alonso Martín"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduccion
A lo largo de este seminario vamos a estudiar como afecta el consumo de antidepresivos a la muerte debido a diferentes enfermedades como la demencia, el cáncer de pancreas y las enfermedades isquémicas.

## Objetivos
### Objetivo global 
El objetivo global de nuestro trabajo es analizar la relacion de antidepresivos/estimulantes con el número de defuncion por enfermedad.
Nuestros datos han sido extraídos desde [Datos.gob](https://datos.gob.es/es/catalogo) en formato .json:
- Número de defunciones por enfermedad según sexo y comunidad autónoma.
- Porcentaje de medicamentos consumidos según sexo y comunidad autónoma.

### Objetivos especificos
- Analizar como afectan los antidepresivos/estimulantes al número de defunciones por demencia 
- Analizar como afectan los antidepresivos/estimulantes al número de defunciones por cáncer de páncreas
- Analizar como afectan los antidepresivos/estimulantes al número de defunciones por enfermedades isquémicas

## Medicamentos 
### Antidepresivos/estimulantes
Los antidepresivos son medicamentos psicotrópicos que se usan para tratar la depresión.
Los estimulantes son sustancias que aumentan los niveles de actividad cognitiva y motriz

##Enfermedades
### Cáncer de páncreas
El cáncer de páncreas se produce por la formación incontrolada de células malignas cancerosas en los tejidos del páncreas, por lo que las celulas sanas de este, dejan de funcionar correctamente.
Síntomas:
- Ictericia
- Materia fecal de color claro
- Orina de color oscuro
- Pérdida de peso de razón desconocida
- Pérdida de apetito
- Dolor en el abdomen y espalda
- Sensación de mucho cansancio

### Enfermedades isquémicas
Las enfermedades isquémicas producen la reducción del flujo sanguíneo en los tejidos del cuerpo humano, es decir disminuye el nivel de nutrientes y oxígeno en las zonas afectadas. 
Síntomas:
- Dolor de cuello o de mandíbula
- Dolor de brazo o de hombro
- Sudoración
- Cansancio
- Dificultad para respirar
- Latido del corazón rápido
- Náuseas y vomitos

### Demencia 
La demencia es una enfermedad que se produce por daños a las celulas del cerebro.Esta lesión celular interfiere con la capacidad de las células cerebrales para comunicarse entre ellas. Cuando estas mismas no pueden comunicarse con normalidad, el pensamiento, el conportamiento y los sentimientos se ven afectados.
Los síntomas de la demencia varian mucho, pero normalmente se ven afetados las siguientes funciones mentales basicas:
-Memoria 
-Comunicación y lenguaje 
-Capacidad de concentrarse y prestar atencion razonamiento y jucio 
-Percepción visual 

## Importacion de datos
### Instalacion de librerias
```{r}
install.packages("rjson")
install.packages("stats")
install.packages("tidyjson", dependencies = TRUE)
```

### Importacion de librerias
```{r}
library(conflicted)
library(rjson)
library(tidyjson)
library(dplyr)
library(tidyverse)
library(readxl)
```

### Datos en Excel
```{r}
enfermedades2 <- read_excel("DATOS/enfermedades.xlsx")
medicamentos2 <- read_excel("DATOS/medicamentos_consumidos.xlsx")
```

### Tabla de las defunciones por enfermedad según sexo
Primero, creamos una tabla llamada "Enfe" igual que la tabla inicial "Enfermedades2", pero a partir de la fila 7 para quedarnos con los datos que nos interesan.
```{r}
Enfe <- enfermedades2%>%
  slice(.data = ., 7:nrow(enfermedades2))
```

Despues, hemos creado un dataframe que contiene las comunidades y los datos de las muertes por demencia según sexo.
Tabla: muertes por cancer de pancreas en todas las comunidades(total, hombre y mujer)
```{r}
# Primero creamos 4 vectores vacíos
comunidades =c()
total = c()
mujer = c()
hombre = c()

# Después vamos recorriendo la tabla Enfe y vamos accediendo a las filas en las que ponga "Demencia". Tras esto añadimos al vector vacío llamado "comunidades" las comunidades que hay en nuestra tabla inicial que se encuentran 21 filas antes que la fila "Demencia".
# A continuación, añadimos a los vectores total, mujer y hombre los datos correspondientes que se encuentran en la 1, 2 o 3 filas siguientes a la fila de "Demencia"

for(i in 1:nrow(Enfe)){
    if(!is.na(Enfe$`Defunciones según causa de muerte. Avance enero-mayo 2020`[i]) && Enfe$`Defunciones según causa de muerte. Avance enero-mayo 2020`[i] == "Demencia"){
      comunidades <- append(comunidades,Enfe$`Defunciones según causa de muerte. Avance enero-mayo 2020`[i-21])
      total <- append(total,Enfe$...2[i+1])
      hombre <- append(hombre,Enfe$...2[i+2])
      mujer <-append(mujer,Enfe$...2[i+3])
  }
}

# Creamos un dataframe llamado muerteDemencia con los vectores creados anteriormente
muerteDemencia <- data.frame(
  Comunidades = comunidades,
  TotalDemencia = as.integer(total),
  HombreDemencia = as.integer(hombre),
  MujerDemencia = as.integer(mujer))
muerteDemencia
```

Además, creamos un dataframe que contiene las comunidades y los datos de las muertes por cáncer de páncreas según sexo.
Tabla: muertes por cáncer de páncreas en todas las comunidades(total, hombre y mujer)
```{r}
# Primero creamos 3 vectores vacíos, esta vez no creamos el vector comunidad porque nos sirve el creado antes
totalCP = c()
mujerCP = c()
hombreCP = c()

# Después vamos recorriendo la tabla Enfe y vamos accediendo a las filas en las que ponga "Cancer de páncreas", tras esto añadimos al vector vacío llamado "comunidades" las comunidades que hay en nuestra tabla inicial que se encuentran 21 filas antes que la fila "Cancer de páncreas".
# A continuación añadimos a los vectores total, mujer y hombre los datos correspondientes que se encuentran en la 1, 2 o 3 filas siguientes a la fila de "Cancer de páncreas"
for(i in 1:nrow(Enfe)){
    if(!is.na(Enfe$`Defunciones según causa de muerte. Avance enero-mayo 2020`[i]) && Enfe$`Defunciones según causa de muerte. Avance enero-mayo 2020`[i] == "Cáncer de páncreas"){
      totalCP <- append(totalCP,Enfe$...2[i+1])
      hombreCP <- append(hombreCP,Enfe$...2[i+2])
      mujerCP <-append(mujerCP,Enfe$...2[i+3])
  }
}

# Creamos un dataframe llamado muerteCancerPancreas con los vectores creados anteriormente
muerteCancerPancreas <- data.frame(
  Comunidades = comunidades,
  TotalCancerPancreas = as.integer(totalCP),
  HombreCancerPancreas = as.integer(hombreCP),
  MujerCancerPancreas = as.integer(mujerCP))
muerteCancerPancreas
```

Por último, hemos creado un dataframe que contiene las comunidades y los datos de las muertes por enfermedades isquémicas según sexo.
Tabla: muertes por enfermedades isquémicas  en todas las comunidades(total, hombre y mujer)
```{r}
# Primero creamos 3 vectores vacíos, esta vez no creamos el vector comunidad porque nos sirve el creado antes
total_isq = c()
mujer_isq = c()
hombre_isq = c()

# Después vamos recorriendo la tabla Enfe y vamos accediendo a las filas en las que ponga "Enfermedades isquémicas del corazón", tras esto añadimos al vector vacío llamado "comunidades" las comunidades que hay en nuestra tabla inicial que se encuentran 21 filas antes que la fila "Enfermedades isquémicas del corazón".
# A continuación añadimos a los vectores total, mujer y hombre los datos correspondientes que se encuentran en la 1, 2 o 3 filas siguientes a la fila de "Enfermedades isquémicas del corazón"
for(i in 1:nrow(Enfe)){
    if(!is.na(Enfe$`Defunciones según causa de muerte. Avance enero-mayo 2020`[i]) && Enfe$`Defunciones según causa de muerte. Avance enero-mayo 2020`[i] == "Enfermedades isquémicas del corazón"){
      total_isq <- append(total_isq,Enfe$...2[i+1])
      hombre_isq <- append(hombre_isq,Enfe$...2[i+2])
      mujer_isq <-append(mujer_isq,Enfe$...2[i+3])
  }
}

# Creamos un dataframe llamado muerteIsquemia con los vectores creados anteriormente
muerteIsquemia <- data.frame(
  Comunidades = comunidades,
  TotalIsquemia = as.integer(total_isq),
  HombreIsquemia = as.integer(hombre_isq),
  MujerIsquemia = as.integer(mujer_isq))
muerteIsquemia

```

### Tabla de consumición de antidepresivos
Hemos creado un dataframe que contiene las comunidades y los datos de la consumición de antidepresivos segun sexo.
Tabla:Consumo de antidepresivos en todas las comunidades(total, hombre y mujer)
```{r}
# Creamos un dataframe que contenga las filas de la tabla medicamentos2 que tienen la información que nos interesa
medicamentosAntidepresivos<- data.frame(
  select(.data = medicamentos2,`Asistencia sanitaria: Cifras relativas`)%>%slice(9:28)%>%rename(Comunidades = `Asistencia sanitaria: Cifras relativas`),
  select(.data = medicamentos2,...39)%>%slice(9:28)%>%rename(TotalAntidepresivos =...39),
  select(.data = medicamentos2,...39)%>%slice(30:49)%>%rename(HombreAntidepresivos =...39),
  select(.data = medicamentos2,...39)%>%slice(51:70)%>%rename(MujerAntidepresivos =...39)
)
# Pasamos los valores antes obtenidos a double para usarlos como números
medicamentosAntidepresivos<-medicamentosAntidepresivos %>% 
  mutate(TotalAntidepresivos = as.double(TotalAntidepresivos)) %>% 
  mutate(HombreAntidepresivos = as.double(HombreAntidepresivos)) %>% 
  mutate(MujerAntidepresivos = as.double(MujerAntidepresivos))

medicamentosAntidepresivos
```

Estos son los datos de la poblacion total y por sexo en 2020 en España sacados de la pagina del Instituto Nacional de Estadística:
```{r}
poblacionEspaña2020<-47318050
poblacionHombres2020<-23210668
poblacionMujeres2020<-24107382
```

Ahora, hacemos la union de los datos de defunciones por demencia y los de medicamentos consumidos. La unión se realiza por la columna "Comunidades" que es la común en las dos tablas.
Tabla: union de medicamentos antidepresivos con muertes por demencia:
```{r}
for(i in 1:nrow(medicamentosAntidepresivos)){
  if(medicamentosAntidepresivos$Comunidades[i] != muerteDemencia$Comunidades[i]){
    medicamentosAntidepresivos$Comunidades[i]<- muerteDemencia$Comunidades[i]
  }
}
unionDem <-full_join(x = medicamentosAntidepresivos, y = muerteDemencia, by = c("Comunidades")) %>%
  arrange(.data = ., TotalDemencia, TotalAntidepresivos)%>%
  summarise(Sexo = c("Hombres", "Mujeres", "Total"),
            Demencia = c(sum(HombreDemencia,na.rm = TRUE)*100/poblacionHombres2020, sum(MujerDemencia,na.rm = TRUE)*100/poblacionMujeres2020, sum(TotalDemencia,na.rm = TRUE)*100/poblacionEspaña2020),
            Antidepresivos = c(mean(HombreAntidepresivos), mean(MujerAntidepresivos), mean(TotalAntidepresivos)))%>%
  pivot_longer(names_to = "Variables", values_to = "Porcentajes", cols = (Demencia:Antidepresivos))
unionDem
```

Después, hacemos la union de los datos de defunciones por cáncer de páncreas y los de medicamentos consumidos. La unión se realiza por la columna "Comunidades" que es la común en las dos tablas.
Tabla: union de medicamentos antidepresivos con muertes por cancer de pancreas 
```{r}
for(i in 1:nrow(medicamentosAntidepresivos)){
  if(medicamentosAntidepresivos$Comunidades[i] != muerteCancerPancreas$Comunidades[i]){
    medicamentosAntidepresivos$Comunidades[i]<- muerteCancerPancreas$Comunidades[i]
  }
}

unionPan <-full_join(x = medicamentosAntidepresivos, y = muerteCancerPancreas, by = c("Comunidades")) %>%
  arrange(.data = ., TotalCancerPancreas, TotalAntidepresivos)%>%
  summarise(Sexo = c("Hombres", "Mujeres", "Total"),
            CancerPancreas = c(sum(HombreCancerPancreas, na.rm = TRUE)*100/poblacionHombres2020, sum(MujerCancerPancreas, na.rm = TRUE)*100/poblacionMujeres2020, sum(TotalCancerPancreas, na.rm = TRUE)*100/poblacionEspaña2020),
            Antidepresivos = c(mean(HombreAntidepresivos), mean(MujerAntidepresivos), mean(TotalAntidepresivos)))%>%
  pivot_longer(names_to = "Variables", values_to = "Porcentajes", cols = (CancerPancreas:Antidepresivos))
unionPan

```

Por último, hacemos la union de los datos de defunciones por enfermedades isquémicas y los de medicamentos consumidos. La unión se realiza por la columna "Comunidades" que es la común en las dos tablas.
Tabla: union de medicamentos antidepresivos con muertes por isquemia 
```{r}
for(i in 1:nrow(medicamentosAntidepresivos)){
  if(medicamentosAntidepresivos$Comunidades[i] != muerteIsquemia$Comunidades[i]){
    medicamentosAntidepresivos$Comunidades[i]<- muerteIsquemia$Comunidades[i]
  }
}

unionIsq <-full_join(x = medicamentosAntidepresivos, y = muerteIsquemia, by = c("Comunidades")) %>%
  arrange(.data = ., TotalIsquemia, TotalAntidepresivos)%>%
  summarise(Sexo = c("Hombres", "Mujeres", "Total"),
            Isquemia = c(sum(HombreIsquemia, na.rm = TRUE)*100/poblacionHombres2020, sum(MujerIsquemia, na.rm = TRUE)*100/poblacionMujeres2020, sum(TotalIsquemia, na.rm = TRUE)*100/poblacionEspaña2020),
            Antidepresivos = c(mean(HombreAntidepresivos), mean(MujerAntidepresivos), mean(TotalAntidepresivos)))%>%
  pivot_longer(names_to = "Variables", values_to = "Porcentajes", cols = (Isquemia:Antidepresivos))
```

## Gráficos
### Importación de librerias
```{r}
library(ggplot2)
library(tidyverse)
```

###Gráfica de antidepresivos con muerte por Demencia
```{r}
graficaDem<-ggplot(union, aes(fill = Variables, y=Porcentajes, x=Sexo)) + 
    geom_bar(position="dodge", stat="identity")
graficaDem+facet_grid("Variables", scales = "free_y")

```

###Gráfica de antidepresivos con muerte por Cancer de Páncreas
```{r}
graficaPan<-ggplot(unionIsq, aes(fill = Variables, y=Porcentajes, x=Sexo)) + 
    geom_bar(position="dodge", stat="identity")
graficaPan+facet_grid("Variables", scales = "free_y")
```

###Gráfica de antidepresivos con muerte por Isquemia
```{r}
graficaIsq<-ggplot(unionIsq, aes(fill = Variables, y=Porcentajes, x=Sexo)) + 
    geom_bar(position="dodge", stat="identity")
graficaIsq+facet_grid("Variables", scales = "free_y")
```

## Bibliografia
-[InformaciónIsquemia](https://www.topdoctors.es/diccionario-medico/isquemia)

-[InformaciónCancerPáncreas](https://www.cancer.gov/espanol/tipos/pancreas/paciente/tratamiento-pancreas-pdq)

-[InformaciónDemencia](https://www.alz.org/alzheimer-demencia/que-es-la-demencia#S%C3%ADntomas)

-[PoblaciónEspaña2020](https://www.ine.es/daco/daco42/ecp/ecp0323.pdf)

-[InformaciónAntidepresivos](https://medlineplus.gov/spanish/antidepressants.html)

-[InformaciónEstimulantes](https://es.wikipedia.org/wiki/Estimulante)
